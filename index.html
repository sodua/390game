<html>
<head>
  <meta charset="UTF-8">
  <script language="javascript" type="text/javascript" src="scripts/p5.js"></script>
  <script language="javascript" type="text/javascript" src="scripts/p5.play.js"></script>
  <script language="javascript" src="scripts/p5.dom.js"></script>
  <script language="javascript" type="text/javascript" src="sketch.js"></script>
  <script language="javascript" type="text/javascript" src="ship.js"></script>
  <script language="javascript" type="text/javascript" src="level.js"></script>

</head>
<body>
  <script src="scripts/virtualjoystick.js"></script>
  <script>
  var shipImage = new Image();
  shipImage.src = "ship.png";
  var joystick	= new VirtualJoystick({
	container	: document.getElementById('defaultCanvas0'),
	mouseSupport	: true,
  });
  var level = [];
  function setup() {
  createCanvas(900, 720);
  
  shipImage = loadImage('assets/ship.png');
  ship = createSprite(64, height/2);
  ship.addImage("normal", shipImage);
  ship.up = function() {
	ship.position.y = ship.position.y - 10;
	if (ship.position.y > 0) {
        ship.rotation -= 1;
		}
  }
  ship.down = function() {
        ship.position.y = ship.position.y + 10;
        if (ship.position.y < 720) { 
		    ship.rotation += 1;
			}
  }
  ship.right = function() {
    if(ship.position.x <= 450) {
	    ship.position.x = ship.position.x + 10;
		}
  }
  ship.left = function() {
      if(ship.position.x >= 0) {
    ship.position.x = ship.position.x - 10;
	}
  }
  ship.update = function() {
    if (ship.position.y > height) {
      ship.position.y = height;
    }
    if (ship.position.y < 0) {
      ship.position.y = 0;
    }
  }
  level.push(new Level());
  
  bulletImage = loadImage('assets/fireball-small.png');
  bullets = new Group();
  }
  function draw() {
  background(0);
  
  if (frameCount % 10 == 0) {
      level.push(new Level());
  }
  for (var i = 0; i < level.length; i++) {
      level[i].show();
      level[i].update();
  }
	
	if (keyIsDown(UP_ARROW)) {
		ship.up();
	}
	if (keyIsDown(DOWN_ARROW)) {
		ship.down();
	}
	if (keyIsDown(RIGHT_ARROW)) {
		ship.right();
	}
	if (keyIsDown(LEFT_ARROW)) {
		ship.left();
	}
	joystick.right() ? ship.right() : '';
	joystick.up() ? ship.up() : '';
	joystick.left() ? ship.left() : '';
	joystick.down() ? ship.down() : '';
 if (keyWentDown('SPACE')) {
      var bullet = createSprite(ship.position.x, ship.position.y);
      bullet.addImage(bulletImage);
      bullet.setSpeed(30, ship.rotation);
      bullet.life = 30;
      bullets.add(bullet);
  }
  drawSprites();
}
	joystick.addEventListener('touchStart', function(){
		console.log('down')
})
	joystick.addEventListener('touchEnd', function(){
		console.log('up')
})
 
</script>
</body>
</html>
